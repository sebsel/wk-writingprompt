/* wanikani-api by takakoshimizu */
!function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(t){var r=e("./wkapi");t.WkApi=r.WkApi}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./wkapi":5}],2:[function(e,t,r){var n=e("./util/jsonp"),i=function(){function e(e){this._apiKey=e,this.API_BASE="https://www.wanikani.com/api/v1.3/user/"}return e.prototype.getData=function(e,t){return n.jsonp(this.constructUrl(e,t))},e.prototype.constructUrl=function(e,t){var r=this.API_BASE+this._apiKey+"/"+e+"/";return t&&(r+=t+"/"),r},e}();r["default"]=i},{"./util/jsonp":3}],3:[function(e,t,r){var n=e("./objectConvert");r.jsonp=function(e){if(!window.Promise)throw"Promise not available. Please apply a polyfill.";var t=function(e,t){var r=document.createElement("script");return r.src=e+(e.indexOf("?")>=0?"&":"?")+"callback="+t,r};return new Promise(function(r,i){var o="jsonp_callback_"+Math.round(1e5*Math.random()),s=t(e,o);s.onerror=i,document.body.appendChild(s),window[o]=function(e){e.error?i(e.error):r(n.convertCase(e)),window[o]=null,delete window[o],document.body.removeChild(s)}})}},{"./objectConvert":4}],4:[function(e,t,r){r.convertCase=function(e){if(!e||"object"!=typeof e)return e;if(e instanceof Array)return e.map(function(e){return r.convertCase(e)});var t={};return Object.keys(e).forEach(function(n){var i=n.replace(/\_(.)/gim,function(e){return e[1].toUpperCase()});t[i]=r.convertCase(e[n])}),t}},{}],5:[function(e,t,r){var n=e("./fetcher"),i=function(){function e(e){if(this._apiKey=e,this._maxLevel=60,this._levelRange="1-"+this._maxLevel,this._expiryTime=3600,this._levelsPerRequest=20,this._lastCriticalRate=0,this._userInformation={},this._studyQueue={},this._levelProgress={},this._srsDistribution={},this._recentUnlocks={},this._criticalItems={},this._radicals={},this._kanji={},this._vocab={},this._storageKeys=["_userInformation","_studyQueue","_levelProgress","_srsDistribution","_recentUnlocks","_criticalItems","_lastCriticalRate","_radicals","_kanji","_vocab"],32!==e.length||!e.match(/[A-z0-9]{32}/))throw"Invalid API Key. API Key must be 32 alphanumeric characters in length.";this._fetcher=new n["default"](e),window.localStorage&&this._loadLocalStorage()}return e.prototype.getUserInformation=function(){var e=this;return this._isValid(this._userInformation)?Promise.resolve(this._userInformation.data):this._fetcher.getData("user-information").then(function(t){return e._setCacheItem(e._userInformation,t)})},e.prototype.getStudyQueue=function(){var e=this;return this._isValid(this._studyQueue)?Promise.resolve(this._studyQueue.data):this._fetcher.getData("study-queue").then(function(t){return e._setCacheItem(e._studyQueue,t)})},e.prototype.getLevelProgression=function(){var e=this;return this._isValid(this._levelProgress)?Promise.resolve(this._levelProgress.data):this._fetcher.getData("level-progression").then(function(t){return e._setCacheItem(e._levelProgress,t)})},e.prototype.getSrsDistribution=function(){var e=this;return this._isValid(this._srsDistribution)?Promise.resolve(this._srsDistribution.data):this._fetcher.getData("srs-distribution").then(function(t){return e._setCacheItem(e._srsDistribution,t)})},e.prototype.getRecentUnlocks=function(e){var t=this;void 0===e&&(e=10);var r=this._recentUnlocks.data&&this._recentUnlocks.data.length!=e;return this._isValid(this._recentUnlocks)&&!r?Promise.resolve(this._recentUnlocks.data):this._fetcher.getData("recent-unlocks",e).then(function(e){return t._setCacheItem(t._recentUnlocks,e)})},e.prototype.getCriticalItems=function(e){var t=this;void 0===e&&(e=75);var r=this._lastCriticalRate!=e;return this._isValid(this._criticalItems)&&!r?Promise.resolve(this._criticalItems.data):(this._lastCriticalRate=e,this._fetcher.getData("critical-items",e).then(function(e){return t._setCacheItem(t._criticalItems,e)}))},e.prototype.getRadicals=function(e){var t=this;return void 0===e&&(e=this._levelRange),this._radicals||(this._radicals={}),this._parseLevelRequest(e).then(function(e){var r=t._findUncachedLevels(t._radicals,e);return 0==r.length?Promise.resolve(t._pickCacheLevels(t._radicals,e)):t._fetcher.getData("radicals",r.join(",")).then(function(r){var n=t._sortToLevels(r.requestedInformation);return t._cacheToLevels(t._radicals,n),t._setCacheItem(null,r),t._pickCacheLevels(t._radicals,e)})})},e.prototype.getKanji=function(e){var t=this;return void 0===e&&(e=this._levelRange),this._kanji||(this._kanji={}),this._parseLevelRequest(e).then(function(e){var r=t._findUncachedLevels(t._kanji,e);if(0==r.length)return Promise.resolve(t._pickCacheLevels(t._kanji,e));for(var n=[];r.length>0;)n.push(t._fetcher.getData("kanji",r.splice(0,t._levelsPerRequest).join(",")));return Promise.all(n).then(function(r){var n=t._sortToLevels(r.reduce(function(e,t){return e.concat(t.requestedInformation)},[]));return t._cacheToLevels(t._kanji,n),t._setCacheItem(null,r[0]),t._pickCacheLevels(t._kanji,e)})})},e.prototype.getVocabulary=function(e){var t=this;return void 0===e&&(e=this._levelRange),this._vocab||(this._vocab={}),this._parseLevelRequest(e).then(function(e){var r=t._findUncachedLevels(t._vocab,e);if(0==r.length)return Promise.resolve(t._pickCacheLevels(t._vocab,e));for(var n=[];r.length>0;)n.push(t._fetcher.getData("vocabulary",r.splice(0,t._levelsPerRequest).join(",")));return Promise.all(n).then(function(r){var n=t._sortToLevels(r.reduce(function(e,t){return e.concat(t.requestedInformation)},[]));return t._cacheToLevels(t._vocab,n),t._setCacheItem(null,r[0]),t._pickCacheLevels(t._vocab,e)})})},e.prototype.setExpiry=function(e){this._expiryTime=e},e.prototype.setLevelsPerRequest=function(e){this._levelsPerRequest=e},e.prototype._parseLevelRequest=function(e){var t=this;return this.getUserInformation().then(function(r){if("number"==typeof e){if(e>r.level)throw new Error("Requested level out of range.");return[e]}if(e instanceof Array){var n=e.filter(function(e){return e>0&&e<r.level});if(0==n.length)throw new Error("Requested levels out of range.");return e}var i=e.split(","),o=i.map(function(e){return t._parseLevelString(e)}).reduce(function(e,t){return e.concat(t)}).filter(function(e,t,r){return r.indexOf(e)==t}).filter(function(e){return e>0&&e<=r.level}).sort(function(e,t){return e-t});if(0==o.length)throw new Error("Requested levels out of range.");return o})},e.prototype._parseLevelString=function(e){if(-1===e.indexOf("-"))return[Number(e)];var t=e.split("-");if(2!==t.length)throw"Invalid level request string";var r=Number(t[0]),n=Number(t[1]);if(r>n)throw"Invalid level request string";return Array.apply(0,Array(n-r+1)).map(function(e,t){return r+t})},e.prototype._findUncachedLevels=function(e,t){var r=this;return t.filter(function(t){return!e[t]||e[t]&&!r._isValid(e[t])})},e.prototype._sortToLevels=function(e){var t={};return e.forEach(function(e){t[e.level]||(t[e.level]={lastUpdated:null,data:[]}),t[e.level].data.push(e)}),t},e.prototype._cacheToLevels=function(e,t){var r=this;return Object.keys(t).forEach(function(n){e[n]=t[n],e[n].lastUpdated=r._getTime()}),e},e.prototype._pickCacheLevels=function(e,t){return t.reduce(function(t,r){return e[r]&&e[r].data?t.concat(e[r].data):t},[])},e.prototype._setCacheItem=function(e,t){var r;return t.requestedInformation&&e&&(e.data=t.requestedInformation,e.lastUpdated=this._getTime(),r=t.requestedInformation),t.userInformation&&(this._userInformation={data:t.userInformation,lastUpdated:this._getTime()},r||(r=t.userInformation)),this._persistLocalStorage(),r},e.prototype._loadLocalStorage=function(){if(window.localStorage.getItem(this._apiKey))for(var e=JSON.parse(window.localStorage.getItem(this._apiKey)),t=0,r=this._storageKeys;t<r.length;t++){var n=r[t];this[n]=e[n]}},e.prototype._persistLocalStorage=function(){if(window.localStorage){for(var e={},t=0,r=this._storageKeys;t<r.length;t++){var n=r[t];this[n]&&(e[n]=this[n])}window.localStorage.setItem(this._apiKey,JSON.stringify(e))}},e.prototype._clearLocalStorage=function(){window.localStorage[this._apiKey]=null},e.prototype._isValid=function(e){if(!e)return!1;if(!e.lastUpdated)return!1;var t=this._getTime(),r=e.lastUpdated+this._expiryTime;return r>t},e.prototype._getTime=function(){return(new Date).getTime()/1e3},e}();r.WkApi=i},{"./fetcher":2}]},{},[1]);